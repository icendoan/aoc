Pad â†  {row â† ((â‰ âŠğ•©)â¥Š '.') â‹„ '.' âˆ¾ Ë˜ '.' âˆ¾ ËœË˜ row âˆ¾ Ëœ row âˆ¾  ğ•©}
grid â†  Pad > â€¢file.Lines "3.in" # 76390429 is the wrong answer
digits â†  '0' + â†• 10

# Part 1
MaskAdj â†  (Â«âŒˆÂ»âŒˆâŠ¢) {ğ”½Ë˜âˆ˜ğ”½} # if a 1 is in a cell, put a 1 in every adjacent cell
ExtendDigitRanges â†  (1<âŠ¢) âˆ˜ ((âŒˆÃ—0â‰ âŠ¢)`{ğ”½âŒ¾âŒ½ ğ”½}Ë˜) âˆ˜ (âˆ§+âŠ¢) # 'wash' intersections back and forward along the rows
ClassifyMaskâ† (+`Â»âŠ¸<)Ã—âŠ¢ # assigns each block of 1s in a mask a unique id

symbols â†  (digits âˆ¾ ".") (â· Â¬âˆ˜âˆŠËœ/âŠ¢) â¥Š grid
adjacent â†  MaskAdj grid âˆŠ symbols
matches â†  adjacent ExtendDigitRanges grid âˆŠ digits
â€¢Show p1 â†  +Â´ â€¢ParseFloatÂ¨ (matches âˆ¾ Ë˜ 0) (Â¯1+ClassifyMask)âŠ¸âŠ” â—‹  â¥Š  (grid âˆ¾ Ë˜ '.') 

# Part 2
has_two_numbers â†  MaskAdj 2 = m â†  Â¯1âŠ¸âŒ½{ğ”½ğ”½Ë˜} (â‰¢grid) â†‘  ((âŒˆÂ´âˆ˜ClassifyMaskâˆ˜â¥Š  Â¯1 âŒ½{ğ”½ğ”½Ë˜} 5â€¿5â†‘  âŠ¢ âˆŠ Digits) âˆ§ '*' = 1â€¿1 âŠ‘ âŠ¢)â‰ 2 3â€¿3 â†• grid
gears â†  has_two_numbers ExtendDigitRanges grid âˆŠ digits
paired â†  (âŒˆÃ—0â‰ âŠ¢)`{ğ”½ğ”½âŒ¾âŒ½}Ë˜ gears (Ã—âŒˆâŠ£) MaskAdj ((âŠ¢Ã—+`)'*'=âŠ¢)âŒ¾â¥Š  grid
number_ids â†  Â¯1 + ClassifyMaskâŒ¾â¥Š  gears
all_gears â† â€¢ParseFloatÂ¨ number_ids âŠ”â—‹ â¥Š grid
gear_ids â† âŠ‘Â¨ number_ids âŠ”â—‹ â¥Š  paired

â€¢Show p2 â†  +Â´Ã—Â´Â¨ (0â‰ â‰ Â¨)âŠ¸/ gear_ids âŠ” all_gears
