text ← •file.Lines "15.in"
map  ← > 50 ↑ text
cmds ← ∾ 51 ↓ text
dir  ← "v^<>"
Step ← {r←1+¯1⊑/1∾(∧`𝕩∊"@O")∧'.'=«𝕩⋄¯1⊸⌽⌾(r↑⊢)𝕩}
View ← { map 𝕊 c:
  y‿x ← (≠∘⊏(⌊∘÷˜⋈|)⊑∘/∘⥊) map = '@'
  f   ← (⊑ dir ⊐ c) ⊑ ⟨x⊸⊏˘,x⊸⊏˘,y⊸⊏,y⊸⊏⟩
  g   ← (⊑ dir ⊐ c) ⊑ ⟨y⊸↓,⌽(y+1)⊸↑,⌽(x+1)⊸↑,x⊸↓⟩
  Step⌾G⌾F map
}
p1 ← +´∾1‿100×⚇1 (≠map) (|⋈⌊∘÷˜)¨ /⥊ 'O' = map View˜´ ⌽cmds
